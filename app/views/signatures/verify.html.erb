<%= turbo_frame_tag "signature_form" do %>
  <div class="bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg max-w-md mx-auto">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6">Verify your email</h2>

    <p class="text-gray-600 dark:text-gray-300 mb-6">
      We've sent a 6-character verification code to <strong><%= @signature.email %></strong>.
      Please enter the code below.
    </p>

    <% if local_assigns[:error] %>
      <div class="bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-700 text-red-800 dark:text-red-200 px-4 py-3 rounded mb-4">
        <%= error %>
      </div>
    <% end %>

    <%= form_with url: confirm_signatures_path, method: :post, data: { turbo_frame: "signature_form", controller: "code-input" } do |f| %>
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Verification code
        </label>
        <div class="flex gap-2 justify-center" data-code-input-target="container">
          <% 6.times do |i| %>
            <input
              type="text"
              name="code_<%= i %>"
              maxlength="1"
              class="w-12 h-12 text-center text-2xl font-bold border-2 border-gray-300 dark:border-gray-600 dark:bg-slate-700 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"
              data-code-input-target="digit"
              data-action="keyup->code-input#handleInput keydown->code-input#handleBackspace paste->code-input#handlePaste"
              <%= "autofocus" if i == 0 %>
            />
          <% end %>
        </div>
        <input type="hidden" name="code" data-code-input-target="hiddenField" />
      </div>

      <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
        Hint: Your code starts with "<%= @verification_code_hint %>"
      </p>

      <div class="mb-4">
        <%= button_tag "Verify", type: "submit", class: "bg-teal-600 text-white dark:text-gray-100 px-6 py-2 rounded-lg hover:bg-teal-700 transition-colors w-full text-center" %>
      </div>

      <div class="mb-4 text-center"
           data-controller="resend-timer"
           data-resend-timer-sent-at-value="<%= @signature.confirmation_code_sent_at&.iso8601 %>">
        <%= link_to "Resend code", resend_code_signatures_path,
            class: "text-sm text-teal-600 dark:text-teal-400 hover:text-teal-700 dark:hover:text-teal-300 #{'hidden' unless @signature.can_resend_code?}",
            data: { resend_timer_target: "link" } %>
        <span class="text-sm text-gray-400 dark:text-gray-500 cursor-not-allowed #{'hidden' if @signature.can_resend_code?}"
              data-resend-timer-target="timer"
              title="Please wait before requesting a new code">
          Resend code (wait 60s)
        </span>
      </div>
    <% end %>

    <div class="text-center">
      <%= link_to "Go back", root_path, class: "text-sm text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100", data: { turbo_frame: "_top" } %>
    </div>
  </div>
<% end %>
